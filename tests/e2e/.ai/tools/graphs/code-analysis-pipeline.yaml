# rye:signed:2026-02-23T09:06:14Z:c7a3154d4997f48674200f6dff663bfb26a2a6129a623e0ca2e87967a55fd5c0:qgg1Q2mVTOKkGiLnqMNgf8JvIBCsDUg998nojGFQu2CpD8x4YYqGmwfyxCOIDLPD-KxwkJna-hPofJRz1I-rDg==:9fbfabe975fa5a7f
version: "1.0.0"
tool_type: graph
executor_id: rye/core/runtimes/state-graph/runtime
category: graphs
description: "Read a Python file, analyze it with an LLM, and produce a structured report"

config_schema:
  type: object
  properties:
    file_path:
      type: string
      description: "Path to the Python file to analyze (relative to project)"
    output_dir:
      type: string
      default: "graph-output"
      description: "Output directory for reports"
  required: [file_path]

config:
  start: read_file
  max_steps: 15

  nodes:
    read_file:
      action:
        primary: execute
        item_type: tool
        item_id: rye/bash/bash
        params:
          command: "cat ${inputs.file_path}"
      assign:
        source_code: "${result.stdout}"
      next: analyze

    analyze:
      action:
        primary: execute
        item_type: tool
        item_id: rye/agent/threads/thread_directive
        params:
          directive_name: test/graphs/analyze_code
          inputs:
            code_snippet: "${state.source_code}"
            output_path: "${inputs.output_dir}/analysis.json"
          limit_overrides:
            turns: 6
            spend: 0.05
      assign:
        analysis_result: "${result.result}"
        thread_id: "${result.thread_id}"
      next: read_analysis

    read_analysis:
      action:
        primary: execute
        item_type: tool
        item_id: rye/bash/bash
        params:
          command: "cat ${inputs.output_dir}/analysis.json 2>/dev/null || echo '{\"error\": \"file not found\"}'"
      assign:
        analysis_json: "${result.stdout}"
      next: write_report

    write_report:
      action:
        primary: execute
        item_type: tool
        item_id: rye/bash/bash
        params:
          command: "mkdir -p ${inputs.output_dir} && echo '# Code Analysis Report\n\n## Source File\n${inputs.file_path}\n\n## Analysis\n${state.analysis_json}\n\n## Thread\n${state.thread_id}' > ${inputs.output_dir}/report.md"
      assign:
        report_written: "${result.success}"
      next: done

    done:
      type: return
