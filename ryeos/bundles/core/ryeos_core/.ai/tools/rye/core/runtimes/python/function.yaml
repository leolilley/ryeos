# rye:signed:2026-02-26T06:42:42Z:5a9cff207c1971b9712192d96e100d3140424c1d33b82f4304747770d05da255:okqCPlmgzGpaAvQgav6Y9tTyRlcbg3nPR8kkyND6-ymHu4fl6JxCy2HP_6G-DE9B1Kj39FhJHzyHuawNCBHxCg==:4b987fd4e40303ac
version: "1.0.0"
tool_type: runtime
executor_id: rye/core/primitives/subprocess
category: rye/core/runtimes/python
description: "Python function runtime - calls execute(params, project_path) and serializes result to stdout"

env_config:
  interpreter:
    type: local_binary
    binary: python
    candidates: [python3]
    search_paths: [".venv/bin", ".venv/Scripts"]
    var: RYE_PYTHON
    fallback: python3
  env:
    PYTHONUNBUFFERED: "1"
    PROJECT_VENV_PYTHON: "${RYE_PYTHON}"

anchor:
  enabled: true
  mode: auto
  markers_any: ["__init__.py", "pyproject.toml"]
  root: tool_dir
  lib: lib
  env_paths:
    PYTHONPATH:
      prepend: ["{anchor_path}", "{runtime_lib}"]

verify_deps:
  enabled: true
  scope: anchor
  recursive: true
  extensions: [".py", ".yaml", ".yml", ".json"]
  exclude_dirs: ["__pycache__", ".venv", "node_modules", ".git", "config"]

config:
  command: "${RYE_PYTHON}"
  args:
    - "-c"
    - |
      import sys,json,importlib.util,inspect,asyncio
      spec=importlib.util.spec_from_file_location("tool",sys.argv[1])
      mod=importlib.util.module_from_spec(spec)
      spec.loader.exec_module(mod)
      fn=getattr(mod,"execute",None)
      if not fn:sys.exit("No execute() in "+sys.argv[1])
      p=json.loads(sys.argv[2])
      if inspect.iscoroutinefunction(fn):r=asyncio.run(fn(p,sys.argv[3]))
      else:r=fn(p,sys.argv[3])
      print(json.dumps(r,default=str)if r is not None else'{}')
    - "{tool_path}"
    - "{params_json}"
    - "{project_path}"
  timeout: 300

config_schema:
  type: object
  properties:
    script:
      type: string
      description: Python module with execute(params, project_path) function
