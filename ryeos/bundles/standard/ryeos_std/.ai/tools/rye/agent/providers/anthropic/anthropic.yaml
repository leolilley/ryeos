# rye:signed:2026-02-26T05:52:24Z:42bf088e5f8dbadbd5a01fd68b9e283cef8f584357b25c9ced281c27e5660b1a:EEX0t2IHSNxsXOQNcFq6a1ehFPLtFfI3LqvjxZScaKMNAhr5BSOuVRawRn5urua2yZ0jkcsC0tTkZCxqF_SoBQ==:4b987fd4e40303ac
tool_id: anthropic
tool_type: http
version: "1.3.0"
description: "Anthropic Messages API â€” system default provider for thread execution"
executor_id: rye/core/primitives/http_client
category: rye/agent/providers/anthropic

requires:
  - net.call

tier_mapping:
  fast: "claude-haiku-4-5-20251001"
  general: "claude-haiku-4-5-20251001"
  high: "claude-sonnet-4-5-20250929"
  max: "claude-opus-4-6"

# Per-million-token pricing (USD)
pricing:
  claude-haiku-4-5-20251001:
    input: 1.00
    output: 5.00
  claude-sonnet-4-5-20250929:
    input: 3.00
    output: 15.00
  claude-opus-4-6:
    input: 5.00
    output: 25.00

env_config:
  env:
    ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY}"

config:
  method: POST
  url: "https://api.anthropic.com/v1/messages"

  auth:
    type: api_key
    key: "${ANTHROPIC_API_KEY}"
    header: x-api-key

  headers:
    Content-Type: application/json
    anthropic-version: "2023-06-01"

  body:
    model: "{model}"
    max_tokens: "{max_tokens}"
    messages: "{messages}"
    tools: "{tools}"
    stream: "{stream}"

  timeout: 120

  retry:
    max_attempts: 2
    backoff: exponential

parameters:
  - name: model
    type: string
    required: true
    default: "claude-haiku-4-5-20251001"
  - name: max_tokens
    type: integer
    required: false
    default: 4096
  - name: messages
    type: array
    required: true
    description: "Array of {role, content} message objects"
  - name: tools
    type: array
    required: false
    default: []
    description: "Array of tool definitions for function calling"

tool_use:
  mode: native
  tool_definition:
    name: "{name}"
    description: "{description}"
    input_schema: "{schema}"

  response_schema:
    content_mode: blocks
    content_path: "content"
    block_detect:
      text: {field: "type", value: "text"}
      tool_call: {field: "type", value: "tool_use"}
    text_value: "text"
    tool_call_name: "name"
    tool_call_input: "input"
    tool_call_id: "id"
    usage_path: "usage"
    input_tokens: "input_tokens"
    output_tokens: "output_tokens"
    finish_reason_path: "stop_reason"
    finish_reason_tool_use: "tool_use"

  message_schema:
    role_map: {user: "user", assistant: "assistant"}
    content_key: "content"
    content_wrap: "blocks_array"
    tool_result:
      role: "user"
      wrap_mode: "content_blocks"
      error_field: "is_error"
      block_template:
        type: "tool_result"
        tool_use_id: "{tool_call_id}"
        content: "{content}"
    tool_call_block_template:
      type: "tool_use"
      id: "{id}"
      name: "{name}"
      input: "{input}"

  stream_schema:
    stream_mode: "event_typed"
    event_type_field: "type"
    message_start_type: "message_start"
    message_start_usage: "message.usage"
    block_start_type: "content_block_start"
    block_start_path: "content_block"
    block_delta_type: "content_block_delta"
    delta_path: "delta"
    delta_type_field: "type"
    text_delta_type: "text_delta"
    text_delta_field: "text"
    tool_input_delta_type: "input_json_delta"
    tool_input_delta_field: "partial_json"
    message_delta_type: "message_delta"
    finish_reason_path: "delta.stop_reason"
    delta_usage_path: "usage"
